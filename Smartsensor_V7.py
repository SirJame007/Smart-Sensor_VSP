#‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ DataFrame ‡∏¢‡πà‡∏≠ pd 
import pandas as pd
#‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
import numpy as np

file_path = 'Somjai888_SoilMoisture_2025-07-21.csv' #‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
MIN_HOURS = 1.5 #‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
MIN_REPEAT_COUNT = 20 #‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏≤ Slope
RISE_THRESHOLD = 3 # ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô ‡∏à‡∏∏‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ-‡∏à‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î < RISE_THRESHOLD
WINDOW_SIZE = 50 # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Slope 
SLOPE_THRESHOLD = 0 # ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤ "‡∏ô‡∏¥‡πà‡∏á"

#WP ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏î‡∏¥‡∏ô‡∏Ç‡∏≤‡∏î‡∏ô‡πâ‡∏≥ FC ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏â‡∏∞
#‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏î‡∏¥‡∏ô ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 7 ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤ FC ‡πÅ‡∏•‡∏∞ PWP ‡∏´‡∏ô‡πâ‡∏≤ 71
#Pv ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡∏î‡∏π‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ % ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ ‡∏´‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å Pv = Pw(%‡∏ô‡∏ô.‡∏î‡∏¥‡∏ô‡πÅ‡∏´‡πâ‡∏á)*As(‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πà‡∏ß‡∏á‡∏à‡∏≥‡πÄ‡∏û‡∏≤‡∏∞)
#As ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡πà‡∏ß‡∏á‡∏à‡∏≥‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£


#‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏° Value ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• index ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
def clean_data(df):
    """‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ NaN ‡πÅ‡∏•‡∏∞ inf ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DataFrame"""
    return df.replace([np.inf, -np.inf], np.nan).dropna(subset=['value']).reset_index(drop=True)
def find_valid_peak(df, min_hours, min_repeat_count, window_size, slope_threshold):
    if df.empty:
        return None, "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á"
    df = clean_data(df)
    if df.empty:
        return None, "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏ö NaN/inf"
    
#‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô value*10 ‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏µ‡πà value_int
    df['value_int'] = (df['value'] * 10).astype(int)
#‡∏´‡∏≤ Index ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå 'value_int' ‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î(idxmax) Index ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ peak_idx
    peak_idx = df['value_int'].idxmax()
# ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤ (timestamp) ‡∏ì ‡∏à‡∏∏‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å peak_idx ‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ peak_time
    peak_time = df.loc[peak_idx, 'unixtimestamp']
#‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ‡∏ì ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ peak_value
    peak_value = df.loc[peak_idx, 'value_int']
#‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô peak ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡πÅ‡∏ñ‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡πá‡∏≠‡∏õ‡πÄ‡∏õ‡πá‡∏ô DataFrame ‡πÉ‡∏´‡∏°‡πà ‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï index ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 0 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πà‡∏≠‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
#df.index.get_loc(peak_idx) ‡∏´‡∏≤ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (location) ‡∏Ç‡∏≠‡∏á Index ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏ (peak_idx) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö iloc ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏ñ‡∏ß
#df.iloc[...:] ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ
#copy(): ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô DataFrame ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç segment ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠ df ‡πÄ‡∏î‡∏¥‡∏°.
    segment = df.iloc[df.index.get_loc(peak_idx):].copy().reset_index(drop=True)
# ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏û‡∏µ‡∏Ñ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πà‡∏≠
    if segment.empty:
        return None, "Segment ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á peak"
#"‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ‚Üí ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    prev_val = peak_value
    for i, row in segment.iloc[1:].iterrows():  #segment.iloc[1:]: ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô DataFrame ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ segment ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ(‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á 0 ‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î Peak) iterrows(): ‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á Pandas ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÉ‡∏ô DataFrame
        diff = row['value_int'] - prev_val  #‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏≤‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á ‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        if diff >= RISE_THRESHOLD: #RISE_THRESHOLD = 3 # ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô ‡∏à‡∏∏‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ-‡∏à‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î < RISE_THRESHOLD
            return None, "‚ùå ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á peak" # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á (‡∏Ñ‡∏∑‡∏≠ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ) ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ None
        prev_val = row['value_int'] #‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ

    # ‡∏´‡∏≤ final point ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Moving Average Slope
    final_index = -1
    repeat_count = 0 #‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô 0 ‡∏Ñ‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏ö
    prev_val_for_repeat = segment['value_int'].iloc[0]
    for idx in range(1, len(segment)):
        if segment['value_int'].iloc[idx] == prev_val_for_repeat:
            repeat_count += 1
        else:
            repeat_count = 0
            prev_val_for_repeat = segment['value_int'].iloc[idx]
    # ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏π‡∏õ‡∏¢‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ô
        if repeat_count >= min_repeat_count:
            last_decreasing_index = -1
            for sub_idx in range(idx, len(segment)):
                if sub_idx >= window_size:
                    window_df = segment.loc[sub_idx - window_size:sub_idx]
                    x = window_df.index
                    y = window_df['value_int']
                    if len(x) > 1:
                        slope, _ = np.polyfit(x, y, 1)
                        if slope < slope_threshold:
                            last_decreasing_index = sub_idx
                        elif last_decreasing_index != -1:
                            final_index = last_decreasing_index
                            break
            if final_index != -1:
                break

    if final_index == -1:
        final_index = len(segment) - 1
    # üîπ ‡∏ñ‡∏≠‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö final_index
    final_val = segment['value_int'].iloc[final_index]
    for back_idx in range(final_index):
        if segment['value_int'].iloc[back_idx] == final_val:
            final_index = back_idx
            break
    final_time = segment.loc[final_index, 'unixtimestamp']
    duration_hours = (final_time - peak_time).total_seconds() / 3600.0
    if duration_hours >= min_hours:
        return segment.loc[:final_index].copy(), "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏ß‡∏•‡∏≤"
    else:
        return None, "‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏ß‡∏•‡∏≤"  # ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏° return statement ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
# ===== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• =====
try:
    df = pd.read_csv(file_path)
    df['unixtimestamp'] = pd.to_datetime(df['unixtimestamp'], unit='s') + pd.Timedelta(hours=7)
    df.sort_values(by='unixtimestamp', inplace=True)
    df.reset_index(drop=True, inplace=True)
except FileNotFoundError:
    print(f"‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå: {file_path}")
    exit()
except Exception as e:
    print(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: {e}")
    exit()

valid_segment = None
while MIN_REPEAT_COUNT >= 5 and valid_segment is None:
    print(f"\n--- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ MIN_REPEAT_COUNT = {MIN_REPEAT_COUNT} ---")
    # ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≠‡∏ö
    try:
        df = pd.read_csv(file_path)
        df['unixtimestamp'] = pd.to_datetime(df['unixtimestamp'], unit='s') + pd.Timedelta(hours=7)
        df.sort_values(by='unixtimestamp', inplace=True)
        df.reset_index(drop=True, inplace=True)
    except Exception as e:
        print(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: {e}")
        break   
    data_search = clean_data(df)
    round_num = 1
    while not data_search.empty:
        segment, reason = find_valid_peak(data_search, MIN_HOURS, MIN_REPEAT_COUNT, WINDOW_SIZE, SLOPE_THRESHOLD) 
        if segment is not None:
            valid_segment = segment
            print(f"‚úÖ ‡∏û‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡πâ‡∏ß‡∏¢ MIN_REPEAT_COUNT = {MIN_REPEAT_COUNT}")
            print(reason)
            break
        else:
            #print(f"‚ùå ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà {round_num}: {reason}")  # ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏≠‡∏≤ comment ‡∏≠‡∏≠‡∏Å
            data_search = clean_data(data_search)
            if data_search.empty:
                break
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if len(data_search) == 0:
                break     
            peak_idx = (data_search['value'] * 10).astype(int).idxmax()
            peak_pos = data_search.index.get_loc(peak_idx)           
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á peak ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if peak_pos + 1 >= len(data_search):
                break               
            data_search = data_search.iloc[peak_pos+1:].reset_index(drop=True)
            round_num += 1
    if valid_segment is None:
        #print(f"\n‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ (MIN_REPEAT_COUNT = {MIN_REPEAT_COUNT})")  # ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏≠‡∏≤ comment ‡∏≠‡∏≠‡∏Å
        MIN_REPEAT_COUNT -= 5       
# ===== ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ =====
if valid_segment is not None:
    print("\nüéØ ‡πÄ‡∏à‡∏≠‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÅ‡∏•‡πâ‡∏ß:")
    print(valid_segment)  
#‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
    peak_time = valid_segment.iloc[0]['unixtimestamp']
    final_time = valid_segment.iloc[-1]['unixtimestamp']   
#‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    evaporation_duration_hours = (final_time - peak_time).total_seconds() / 3600.0
    print(f"\n‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ä‡∏ô‡∏¥‡∏î‡∏î‡∏¥‡∏ô")
    print(f"‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡πÄ‡∏´‡∏¢‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏à‡∏≤‡∏Å‡∏î‡∏¥‡∏ô: {evaporation_duration_hours:.2f} ‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á")   
    peak_value = valid_segment.iloc[0]['value']
    final_value = valid_segment.iloc[-1]['value']
#‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SDR ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏ä‡∏°.‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if evaporation_duration_hours > 2:
        SDR = (peak_value - final_value) / evaporation_duration_hours
        print(f"‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡πÄ‡∏´‡∏¢‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥ (SDR): {SDR:.2f} % ‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á")       
        if  SDR >= 2:
            soil_type = "‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏¢"
        elif 0.5 <= SDR < 2:
            soil_type = "‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô"
        elif SDR < 0.5:
            soil_type = "‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß"
        else: 
            soil_type = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"
        print(f"‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏î‡∏¥‡∏ô: {soil_type}")
#Dr ‡∏à‡∏∞‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏ô‡∏•‡∏î‡∏•‡∏á‡πÉ‡∏ô ‡∏ä‡∏°.‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå
        #Dr = (SDR*evaporation_duration_hours) /100  #‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô
        #print(f"Dr = {Dr:.2f} % ‡πÉ‡∏ô {evaporation_duration_hours:.2f} ‡∏ä‡∏°. ")  
#‡∏´‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ç‡∏≠‡∏á‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 
        #print(f"MDR : {MDR:.2f} ‡∏ä‡∏°.")


#‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• FC PWP Pv ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
        import json
        with open('Plant_information.json', 'r', encoding='utf-8') as f:
            plant_data = json.load(f)
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ô
        def get_soil_info(soil_type):
            if soil_type not in plant_data:
                return None
            return {k: v for d in plant_data[soil_type] for k, v in d.items()}
        soil_info = get_soil_info(soil_type)
        if soil_info:
            FC = soil_info["FC"]
            PWP = soil_info["PWP"]
            Pv = soil_info["Pv"]
            print(f"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•{soil_type}: \nFC = {FC:.2f}\nPWP = {PWP:.2f}\nPv = {Pv:.2f}")
        else:
            print("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ô")
        def get_plant_info(plant_name, month):
            if plant_name not in plant_data:
                return None   
            for entry in plant_data[plant_name]:
                start, end = map(int, entry["age_months"].split('-'))
                if start <= month <= end:
                    return {"Zr": entry["Zr"], "Kc": entry["Kc"]}  
            return None
#‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å
        plant_name = "durian"
        print(f"Crop : {plant_name}")
        age_month = 6
        print(f"age : {age_month} month ")
        info = get_plant_info(plant_name, age_month)
        if info:
            Zr = info["Zr"]
            Kc = info["Kc"]
            print(f"Zr = {Zr} mm.\nKc = {Kc}")
           
#‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        Realtime_Sensor = 0.17
       
#TAW (‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏î‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
#RAW (‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡∏î‡∏π‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏ô‡πâ‡∏≥)
#Dr (‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏Å)
        print(f"\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏™‡∏°‡∏Å‡∏≤‡∏£ FAO-56")
        TAW = (FC - PWP)*Zr
        print(f"TAW : {TAW:.2f}") 
        RAW = Pv * TAW
        print(f"RAW : {RAW:.2f}")   
#‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        Dr = (FC-Realtime_Sensor)* Zr
        print(f"Dr : {Dr:.2f}")

#‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Rang Ks (0-1) 
#Ks (‡∏Ñ‡πà‡∏≤‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡∏ä)
        if Dr > RAW :
            Ks = (TAW - Dr) / (TAW - RAW)
            if Ks > 1:
                Ks = 1
            elif Ks < 0:
                Ks = 0
            print(f"Ks : {Ks:.2f}")    
#‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ FC (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏î‡∏¥‡∏ô)
        else :
            RTS_FC = (Realtime_Sensor- FC)*100
            print(f"‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡∏ä‡∏à‡∏∞‡∏î‡∏π‡∏î‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà {RTS_FC:.2f} % ")
            Ks = 1
#‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Ks
        if 0.95 <= Ks <= 1.0:
            Ks_Alarm = "‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏î‡∏¥‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏û‡∏∑‡∏ä‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°"
        elif 0.85 <= Ks < 0.95:
            Ks_Alarm = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏õ‡∏≤‡∏Å‡πÉ‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á ‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á"
        elif 0.70 <= Ks < 0.85:
            Ks_Alarm = "‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏ô‡πâ‡∏≠‡∏¢ ‡∏õ‡∏≤‡∏Å‡πÉ‡∏ö‡∏õ‡∏¥‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏ä‡∏±‡∏î ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏î‡∏ô‡πâ‡∏≥"
        elif 0.50 <= Ks < 0.70:
            Ks_Alarm = "‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏™‡∏á‡∏•‡∏î‡∏•‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡∏î‡∏ô‡πâ‡∏≥"
        elif 0.30 <= Ks < 0.50:
            Ks_Alarm = "‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏™‡∏á ‡∏Ñ‡∏ß‡∏£‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô"
        elif 0.15 <= Ks < 0.30:
            Ks_Alarm = "‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡πÉ‡∏ö‡πÄ‡∏´‡∏µ‡πà‡∏¢‡∏ß‡∏á‡∏≠ ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!"
        elif Ks <0.20 <= Ks < 0.15:
            Ks_Alarm = "‡∏ß‡∏¥‡∏Å‡∏§‡∏ï ‡πÉ‡∏Å‡∏•‡πâ/‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏´‡∏µ‡πà‡∏¢‡∏ß‡∏ñ‡∏≤‡∏ß‡∏£ ‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡πÄ‡∏ó‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!"
        elif Ks <0.20 <= Ks < 0.15:
            Ks_Alarm = "‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ ‡∏î‡∏¥‡∏ô‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏û‡∏∑‡∏ä‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏´‡∏µ‡πà‡∏¢‡∏ß‡∏ñ‡∏≤‡∏ß‡∏£"
        else:
            Ks_Alarm = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Ks"
        print(f"‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏∑‡∏ä : {Ks_Alarm}")
        #print(f"Ks = {Ks:.2f} ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏∑‡∏ä: {Ks_Alarm}")
else:
        soil_type = "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"